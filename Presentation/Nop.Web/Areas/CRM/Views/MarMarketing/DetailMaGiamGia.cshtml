@model MarMaGiamGiaModel
@{
    //page title
    ViewBag.Title = "Chi tiết phiếu giảm giá";
    //active menu item (system name)
    Html.SetActiveMenuItemSystemName("Marketing.SuKien");
}

<input asp-for="MarketingId" type="hidden" />
<div class="content d-flex flex-column flex-column-fluid">
    <div class="container">
        <div class="alert alert-custom alert-white alert-shadow fade show gutter-b" role="alert">
            <div class="alert-icon">
                <span class="svg-icon svg-icon-primary svg-icon-xl">
                    <!--begin::Svg Icon | path:/metronic/theme/html/demo9/dist/assets/media/svg/icons/Tools/Compass.svg-->
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24"></rect>
                            <path d="M7.07744993,12.3040451 C7.72444571,13.0716094 8.54044565,13.6920474 9.46808594,14.1079953 L5,23 L4.5,18 L7.07744993,12.3040451 Z M14.5865511,14.2597864 C15.5319561,13.9019016 16.375416,13.3366121 17.0614026,12.6194459 L19.5,18 L19,23 L14.5865511,14.2597864 Z M12,3.55271368e-14 C12.8284271,3.53749572e-14 13.5,0.671572875 13.5,1.5 L13.5,4 L10.5,4 L10.5,1.5 C10.5,0.671572875 11.1715729,3.56793164e-14 12,3.55271368e-14 Z" fill="#000000" opacity="0.3"></path>
                            <path d="M12,10 C13.1045695,10 14,9.1045695 14,8 C14,6.8954305 13.1045695,6 12,6 C10.8954305,6 10,6.8954305 10,8 C10,9.1045695 10.8954305,10 12,10 Z M12,13 C9.23857625,13 7,10.7614237 7,8 C7,5.23857625 9.23857625,3 12,3 C14.7614237,3 17,5.23857625 17,8 C17,10.7614237 14.7614237,13 12,13 Z" fill="#000000" fill-rule="nonzero"></path>
                        </g>
                    </svg>
                    <!--end::Svg Icon-->
                </span>
            </div>
            <div class="alert-text">Mã giảm giá</div>
            <div class="d-flex align-items-center">
                <a href="../MarMarketing/CreateMaGiamGia" class="btn btn-light-primary font-weight-bolder btn-sm">Thêm mới</a>
            </div>
        </div>

        <div class="row">
            <div class="col-xl-4">
                <div class="card card-custom card-stretch gutter-b">
                    <div class="card-body d-flex flex-column p-0" style="position: relative;">
                        <div class="d-flex align-items-center justify-content-between card-spacer flex-grow-1">
                            <div class="d-flex flex-column mr-2">
                                <a href="javascript:LoadDataGridView(0)" class="text-dark-75 text-hover-primary font-weight-bolder font-size-h5">Tổng</a>
                                <span class="text-muted font-weight-bold mt-2">Tổng số phiếu giảm giá</span>
                            </div>
                            <span class="symbol symbol-light-danger symbol-45">
                                <span class="symbol-label font-weight-bolder font-size-h6">@Model.SoPhieuTao</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card card-custom card-stretch gutter-b">
                    <div class="card-body d-flex flex-column p-0" style="position: relative;">
                        <div class="d-flex align-items-center justify-content-between card-spacer">
                            <div class="d-flex flex-column mr-2">
                                <a href="javascript:LoadDataGridView(1)" class="text-dark-75 text-hover-primary font-weight-bolder font-size-h5">Đã gửi</a>
                                <span class="text-muted font-weight-bold mt-2">Tổng số phiếu đã gửi đến khách hàng</span>
                            </div>
                            <span class="symbol symbol-light-success symbol-45">
                                <span class="symbol-label font-weight-bolder font-size-h6">@Model.SoPhieuDaGui</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card card-custom card-stretch gutter-b">
                    <div class="card-body d-flex flex-column p-0" style="position: relative;">
                        <div class="d-flex align-items-center justify-content-between card-spacer">
                            <div class="d-flex flex-column mr-2">
                                <a href="javascript:LoadDataGridView(2)" class="text-dark-75 text-hover-primary font-weight-bolder font-size-h5">Đã sử dụng</a>
                                <span class="text-muted font-weight-bold mt-2">Tổng số phiếu đã được sử dụng</span>
                            </div>
                            <span class="symbol symbol-light-primary symbol-45">
                                <span class="symbol-label font-weight-bolder font-size-h6">@Model.SoPhieuKhachHangDaSuDung</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h5 class="card-header">
                Tình trạng các phiếu giảm giá
                <a href="javascript:TangPhieuTheoKhachHang(@Model.MarketingId)" class="btn btn-light-danger font-weight-bolder btn-sm" style="float: right; margin-left: 10px; margin-right: 10px;">Tặng theo khách hàng</a>
                <a href="javascript:TangPhieuTheoHangKhachHang(@Model.MarketingId)" class="btn btn-light-warning font-weight-bolder btn-sm" style="float: right; margin-left: 10px; margin-right: 10px;">Tặng theo hạng khách hàng</a>
                <a href="javascript:TangPhieuTheoNhomKhachHang(@Model.MarketingId)" class="btn btn-light-success font-weight-bolder btn-sm" style="float: right; margin-left: 10px; margin-right: 10px;">Tặng theo nhóm khách hàng</a>
            </h5>
            <div class="card-body">
                <nop-antiforgery-token />
                <input asp-for="marMaGiamGiaSearchModel.MarketingId" type="hidden" />
                <input type="hidden" id="TrangThaiPhieu">
                <div class="d-flex flex-column-fluid">
                    <div class="container">
                        <div class="kt-portlet__body">
                            @await Html.PartialAsync("Table", new DataTablesModel
                            {
                                Name = "items-MarMaGiamGia",
                                UrlRead = new DataUrl("List", "MarMaGiamGia", null),
                                Length = Model.marMaGiamGiaSearchModel.PageSize,
                                LengthMenu = Model.marMaGiamGiaSearchModel.AvailablePageSizes,
                                Filters = new List<FilterParameter>
                                {
                                    new FilterParameter(nameof(Model.MarketingId)),
                                    new FilterParameter(name: nameof(Model.marMaGiamGiaSearchModel.MarketingId), value: Model.MarketingId),
                                    new FilterParameter(nameof(MarMaGiamGiaSearchModel.TrangThaiPhieu))
                                },
                                ColumnCollection = new List<ColumnProperty>
                                {
                                    new ColumnProperty(nameof(MarMaGiamGiaModel.MA))
                                    {
                                        Title = "Mã",
                                    },
                                    new ColumnProperty(nameof(MarMaGiamGiaModel.TrangThaiPhieu))
                                    {
                                        Title = "Trạng thái",
                                    },
                                    new ColumnProperty(nameof(MarMaGiamGiaModel.TenKhachHang))
                                    {
                                        Title = "Khách hàng",
                                    },
                                    new ColumnProperty(nameof(MarMaGiamGiaModel.NGAY_SU_DUNG))
                                    {
                                        Title = "Ngày sử dụng",
                                    },
                                }
                            })
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function TangPhieuTheoKhachHang(marId) {
        var _url = "@(Url.Action("_TangTheoKhachHang", "MarMarketing"))?marId=" + marId;
	    var titlePopup = "Tặng theo khách hàng";
        OpenModalManual(titlePopup, _url, "modal-lg");
    }

    function TangPhieuTheoHangKhachHang(marId) {
        var _url = "@(Url.Action("_TangTheoHangKhachHang", "MarMarketing"))?marId=" + marId;
        var titlePopup = "Tặng theo hạng khách hàng";
        OpenModalManual(titlePopup, _url, "modal-lg");
    }

    function TangPhieuTheoNhomKhachHang(marId) {
        var _url = "@(Url.Action("_TangTheoNhomKhachHang", "MarMarketing"))?marId=" + marId;
	    var titlePopup = "Tặng theo nhóm khách hàng";
        OpenModalManual(titlePopup, _url, "modal-lg");
    }

    function LoadDataGridView(e) {
        $("#TrangThaiPhieu").val(e);

        $("#items-MarMaGiamGia").DataTable().ajax.reload();
    }
</script>